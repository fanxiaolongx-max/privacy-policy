<!doctype html>
<html lang="zh-CN">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>Excel åˆ—å¤„ç†å·¥å…·ï¼ˆHTMLç‰ˆï¼šè¡¥é½8ä½/åŒå†…å®¹ç€è‰²/å¯¼å‡ºå«é¢œè‰²+æ–‡æœ¬æ ¼å¼ï¼‰</title>
  <style>
    body{font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial; margin:18px; line-height:1.35;}
    h2{margin:0 0 10px;}
    .row{display:flex; gap:12px; flex-wrap:wrap; align-items:center;}
    .card{border:1px solid #e6e6e6; border-radius:14px; padding:14px; box-shadow:0 1px 10px rgba(0,0,0,.04); margin:12px 0;}
    label{font-weight:600;}
    select,input[type="text"]{padding:8px 10px; border:1px solid #d7d7d7; border-radius:10px; min-width:220px;}
    button{padding:10px 12px; border:1px solid #d7d7d7; border-radius:12px; background:#fff; cursor:pointer;}
    button:hover{background:#f7f7f7;}
    button:disabled{opacity:.55; cursor:not-allowed;}
    .muted{color:#666; font-size:13px;}
    .ok{background:#f2fff3; border:1px solid #c9f2cf; padding:10px; border-radius:12px; white-space:pre-wrap;}
    .err{background:#fff3f3; border:1px solid #ffd0d0; padding:10px; border-radius:12px; white-space:pre-wrap;}
    table{border-collapse:collapse; width:100%; font-size:13px;}
    th,td{border:1px solid #e7e7e7; padding:6px 8px; vertical-align:top;}
    th{background:#fafafa; text-align:left;}
    .pill{display:inline-block; padding:2px 8px; border:1px solid #e0e0e0; border-radius:999px; font-size:12px; color:#555;}
    .spacer{flex:1;}
    .mono{font-family:ui-monospace,Consolas,monospace;}
    .small{font-size:12px; color:#777;}
    .preview-wrap{max-height:420px; overflow:auto; border-radius:12px; border:1px solid #e7e7e7;}
    .hint{margin-top:8px;}
  </style>

  <!-- âœ… xlsx-js-styleï¼šæ”¯æŒå†™å…¥å•å…ƒæ ¼æ ·å¼ï¼ˆå¡«å……è‰²ã€numFmt ç­‰ï¼‰ -->
  <script src="https://cdn.jsdelivr.net/npm/xlsx-js-style@1.2.0/dist/xlsx.bundle.js"></script>
</head>
<body>
  <h2>Excel åˆ—å¤„ç†å·¥å…·ï¼ˆHTMLç‰ˆï¼‰</h2>
  <div class="muted">å¯¼å…¥ Excel â†’ é€‰æ‹©é¡µç­¾/åˆ— â†’ è¡¥é½8ä½ï¼ˆå¯¼å‡ºå¼ºåˆ¶æ–‡æœ¬ï¼‰/ åŒå†…å®¹ç€è‰²ï¼ˆå¯¼å‡ºå«é¢œè‰²ï¼‰ â†’ å¯¼å‡ºæ–° Excelï¼ˆæ— éœ€å®ï¼‰</div>

  <div class="card">
    <div class="row">
      <label>å¯¼å…¥ Excelï¼š</label>
      <input id="file" type="file" accept=".xlsx,.xls,.xlsb,.csv" />
      <span class="pill" id="fileInfo">æœªå¯¼å…¥</span>
      <span class="spacer"></span>
      <button id="btnExport" disabled>â¬‡ï¸ å¯¼å‡ºä¸ºæ–° Excelï¼ˆå«é¢œè‰² + æ–‡æœ¬æ ¼å¼ï¼‰</button>
    </div>
    <div class="small hint">è¯´æ˜ï¼šæ–‡ä»¶åªåœ¨æµè§ˆå™¨æœ¬åœ°å¤„ç†ï¼Œä¸ä¼šä¸Šä¼ ã€‚</div>
  </div>

  <div class="card">
    <div class="row">
      <label>é€‰æ‹©é¡µç­¾ï¼š</label>
      <select id="sheetSel" disabled></select>

      <label>é€‰æ‹©åˆ—ï¼š</label>
      <select id="colSel" disabled></select>

      <label class="row" style="gap:6px;">
        <input type="checkbox" id="hasHeader" checked />
        <span>é¦–è¡Œæ˜¯è¡¨å¤´ï¼ˆä¸å¤„ç†ç¬¬1è¡Œï¼‰</span>
      </label>

      <label class="row" style="gap:6px;">
        <input type="checkbox" id="skipBlanks" checked />
        <span>è·³è¿‡ç©ºå€¼</span>
      </label>

      <label class="row" style="gap:6px;">
        <input type="checkbox" id="randomColor" />
        <span>éšæœºé…è‰²</span>
      </label>
    </div>

    <div class="row" style="margin-top:10px;">
      <button id="btnPad8" disabled>ğŸ”¢ è¡¥é½ä¸º8ä½ç¼–ç ï¼ˆå¯¼å‡ºæŒ‰æ–‡æœ¬ï¼‰</button>
      <button id="btnColorize" disabled>ğŸ¨ åŒå†…å®¹åŒé¢œè‰²ï¼ˆè¯¥åˆ—ç€è‰²å¹¶ä¿ç•™ï¼‰</button>
      <button id="btnClearColor" disabled>ğŸ§½ æ¸…é™¤è¯¥åˆ—ç€è‰²</button>
      <button id="btnCopyCol" disabled>ğŸ“‹ å¤åˆ¶è¯¥åˆ—ï¼ˆç²˜è´´åˆ°Excelï¼‰</button>
      <span class="spacer"></span>
      <span class="muted">é¢„è§ˆä»…å±•ç¤ºå‰ 50 è¡Œ</span>
    </div>
  </div>

  <div id="msg"></div>

  <div class="card">
    <div class="row">
      <label>æ•°æ®é¢„è§ˆï¼ˆå‰ 50 è¡Œï¼‰ï¼š</label>
      <span class="pill">å½“å‰é¡µç­¾ï¼š<span id="curSheet" class="mono">-</span></span>
      <span class="pill">å½“å‰åˆ—ï¼š<span id="curCol" class="mono">-</span></span>
      <span class="pill">å·²ç€è‰²åˆ—æ•°ï¼š<span id="coloredCount" class="mono">0</span></span>
      <span class="pill">å·²è¡¥é½æ–‡æœ¬åˆ—æ•°ï¼š<span id="paddedCount" class="mono">0</span></span>
    </div>
    <div class="preview-wrap">
      <table id="previewTbl">
        <thead></thead>
        <tbody></tbody>
      </table>
    </div>
    <div class="small hint">
      è¯´æ˜ï¼šå¯¼å‡ºä¼šä¿ç•™â€œæœ¬å·¥å…·ç”Ÿæˆâ€çš„é¢œè‰²ä¸æ–‡æœ¬æ ¼å¼ï¼ˆç”¨äºä¿ç•™å‰å¯¼0ï¼‰ã€‚
      åŸå§‹æ–‡ä»¶è‡ªå¸¦çš„é¢œè‰²/æ ·å¼ï¼Œå¤§å¤šæµè§ˆå™¨åº“æ— æ³•å®Œæ•´è¯»å–ï¼Œå› æ­¤ä¸ä¿è¯åŸæ ·å¼èƒ½è¢«å®Œæ•´ä¿ç•™ã€‚
    </div>
  </div>

<script>
(() => {
  const $ = (id) => document.getElementById(id);

  let wb = null;                   // workbook
  let sheetName = null;            // current sheet
  let colIndex = null;             // selected column index (0-based)

  // âœ… ä¿å­˜æ¯ä¸ª sheet çš„æ•°æ®ï¼ˆå¯è¢«ä¿®æ”¹ï¼‰
  const modifiedSheets = new Map();      // sheetName -> AOA

  // âœ… ä¿å­˜æ¯ä¸ª sheet çš„â€œåˆ—ç€è‰²æ˜ å°„â€
  // colorMaps.get(sheetName).get(colIndex) -> Map(value -> "rgb(r,g,b)")
  const colorMaps = new Map();

  // âœ… è®°å½•æ¯ä¸ª sheet å“ªäº›åˆ—åšè¿‡â€œè¡¥é½8ä½â€ï¼ˆå¯¼å‡ºæ—¶å¼ºåˆ¶æ–‡æœ¬æ ¼å¼ï¼‰
  // padCols.get(sheetName) = Set(colIndex)
  const padCols = new Map();

  const softPalette = [
    [255,235,238],[232,245,233],[227,242,253],[255,249,196],
    [243,229,245],[255,224,178],[225,245,254],[241,248,233],
    [252,228,236],[224,247,250],[237,231,246],[255,243,224]
  ];

  function rgb(arr){ return `rgb(${arr[0]},${arr[1]},${arr[2]})`; }

  function randSoft(seed){
    // deterministic-ish random by seed
    const f = (k) => {
      const x = Math.sin((seed+k) * 9999) * 10000;
      return 200 + Math.floor((x - Math.floor(x)) * 56);
    };
    return `rgb(${f(0)},${f(1)},${f(2)})`;
  }

  function showMsg(type, text){
    $("msg").innerHTML = `<div class="${type}">${text}</div>`;
  }

  function getSheetAOA(name){
    if (modifiedSheets.has(name)) return modifiedSheets.get(name);
    const ws = wb.Sheets[name];
    const aoa = XLSX.utils.sheet_to_json(ws, {header:1, raw:false, defval:""});
    modifiedSheets.set(name, aoa);
    return aoa;
  }

  function setSheetAOA(name, aoa){
    modifiedSheets.set(name, aoa);
  }

  function getColorMapFor(sheet, col){
    if (!colorMaps.has(sheet)) colorMaps.set(sheet, new Map());
    const m = colorMaps.get(sheet);
    if (!m.has(col)) m.set(col, new Map());
    return m.get(col);
  }

  function deleteColorMapFor(sheet, col){
    if (!colorMaps.has(sheet)) return;
    colorMaps.get(sheet).delete(col);
    if (colorMaps.get(sheet).size === 0) colorMaps.delete(sheet);
  }

  function countColoredCols(sheet){
    if (!colorMaps.has(sheet)) return 0;
    return colorMaps.get(sheet).size;
  }

  function markPaddedCol(sheet, col){
    if (!padCols.has(sheet)) padCols.set(sheet, new Set());
    padCols.get(sheet).add(col);
  }

  function countPaddedCols(sheet){
    if (!padCols.has(sheet)) return 0;
    return padCols.get(sheet).size;
  }

  function colLetter(n){
    let s = ""; n++;
    while (n > 0){
      const m = (n - 1) % 26;
      s = String.fromCharCode(65 + m) + s;
      n = Math.floor((n - 1) / 26);
    }
    return s;
  }

  function getHeaderOrFirstNonEmpty(aoa, c, hasHeader){
    if (!aoa || aoa.length === 0) return "";
    if (hasHeader){
      const h = String(aoa[0]?.[c] ?? "").trim();
      if (h) return h;
    }
    for (let r = hasHeader ? 1 : 0; r < aoa.length; r++){
      const v = String(aoa[r]?.[c] ?? "").trim();
      if (v) return v;
    }
    return "";
  }

  function normalizeDigits(v){
    return String(v ?? "").trim().replace(/\s+/g, "");
  }

  function pad8(value){
    const s = normalizeDigits(value);
    if (!s) return {ok:false, reason:"ç©ºå€¼"};
    if (!/^\d+$/.test(s)) return {ok:false, reason:"éçº¯æ•°å­—"};
    if (s.length > 8) return {ok:false, reason:"è¶…è¿‡8ä½"};
    return {ok:true, value: s.padStart(8, "0")};
  }

  function toHexFromRgb(rgbStr){
    const m = rgbStr.match(/rgb\((\d+),(\d+),(\d+)\)/);
    if (!m) return null;
    const toHex = (n) => (+n).toString(16).padStart(2,"0").toUpperCase();
    return `${toHex(m[1])}${toHex(m[2])}${toHex(m[3])}`;
  }

  function refreshPreview(){
    if (!wb || !sheetName) return;

    const aoa = getSheetAOA(sheetName);
    const maxCols = Math.max(...aoa.map(r => r.length), 0);

    $("curSheet").textContent = sheetName;
    $("curCol").textContent = (colIndex === null) ? "-" : `${colLetter(colIndex)} (${colIndex+1})`;
    $("coloredCount").textContent = String(countColoredCols(sheetName));
    $("paddedCount").textContent = String(countPaddedCols(sheetName));

    const thead = $("previewTbl").querySelector("thead");
    const tbody = $("previewTbl").querySelector("tbody");
    thead.innerHTML = "";
    tbody.innerHTML = "";

    const headerRow = document.createElement("tr");
    for (let c = 0; c < maxCols; c++){
      const th = document.createElement("th");
      th.textContent = `${colLetter(c)}`;
      headerRow.appendChild(th);
    }
    thead.appendChild(headerRow);

    const previewRows = Math.min(50, aoa.length);

    // âœ… é¢„è§ˆæ—¶å¯¹â€œæ‰€æœ‰å·²ç€è‰²åˆ—â€éƒ½æ˜¾ç¤ºé¢œè‰²
    const sheetColorCols = colorMaps.has(sheetName) ? colorMaps.get(sheetName) : new Map();

    for (let r = 0; r < previewRows; r++){
      const tr = document.createElement("tr");
      for (let c = 0; c < maxCols; c++){
        const td = document.createElement("td");
        const v = (aoa[r] && aoa[r][c] !== undefined) ? aoa[r][c] : "";
        const text = String(v);
        td.textContent = text;

        if (sheetColorCols.has(c)){
          const map = sheetColorCols.get(c);
          const key = text.trim();
          if (key){
            const color = map.get(key);
            if (color) td.style.background = color;
          }
        }

        tr.appendChild(td);
      }
      tbody.appendChild(tr);
    }
  }

  function loadSheets(){
    $("sheetSel").innerHTML = "";
    wb.SheetNames.forEach((n) => {
      const opt = document.createElement("option");
      opt.value = n; opt.textContent = n;
      $("sheetSel").appendChild(opt);
    });
    $("sheetSel").disabled = false;
    sheetName = wb.SheetNames[0];
    $("sheetSel").value = sheetName;
    loadColumns();
  }

  function loadColumns(){
    const aoa = getSheetAOA(sheetName);
    const hasHeader = $("hasHeader").checked;
    const cols = Math.max(...aoa.map(r => r.length), 0);

    $("colSel").innerHTML = "";
    for (let c = 0; c < cols; c++){
      const title = getHeaderOrFirstNonEmpty(aoa, c, hasHeader);
      const opt = document.createElement("option");
      opt.value = String(c);
      opt.textContent = title ? `${colLetter(c)}: ${title}` : `${colLetter(c)}`;
      $("colSel").appendChild(opt);
    }

    $("colSel").disabled = cols === 0;
    colIndex = cols ? 0 : null;
    if (cols) $("colSel").value = "0";

    const enabled = !!cols;
    $("btnPad8").disabled = !enabled;
    $("btnColorize").disabled = !enabled;
    $("btnClearColor").disabled = !enabled;
    $("btnCopyCol").disabled = !enabled;
    $("btnExport").disabled = !wb;

    refreshPreview();
  }

  // ---- Events ----
  $("file").addEventListener("change", async (e) => {
    const f = e.target.files?.[0];
    if (!f) return;

    try{
      const buf = await f.arrayBuffer();
      wb = XLSX.read(buf, {type:"array"});

      modifiedSheets.clear();
      colorMaps.clear();
      padCols.clear();
      sheetName = null;
      colIndex = null;

      $("fileInfo").textContent = f.name;
      showMsg("ok", "å·²å¯¼å…¥æ–‡ä»¶ã€‚è¯·é€‰æ‹©é¡µç­¾ä¸åˆ—ï¼Œç„¶åæ‰§è¡Œå¤„ç†ã€‚");

      loadSheets();

      $("btnExport").disabled = false;
      $("sheetSel").disabled = false;
      $("colSel").disabled = false;
    }catch(err){
      console.error(err);
      showMsg("err", "å¯¼å…¥å¤±è´¥ï¼š" + (err?.message || err));
    }
  });

  $("sheetSel").addEventListener("change", () => {
    sheetName = $("sheetSel").value;
    loadColumns();
  });

  $("colSel").addEventListener("change", () => {
    colIndex = parseInt($("colSel").value, 10);
    refreshPreview(); // âœ… ä¸æ¸…ç©ºé¢œè‰²/è¡¥é½è®°å½•
  });

  $("hasHeader").addEventListener("change", () => loadColumns());

  $("btnPad8").addEventListener("click", () => {
    if (!wb || colIndex === null) return;
    const aoa = getSheetAOA(sheetName);
    const hasHeader = $("hasHeader").checked;
    const skipBlanks = $("skipBlanks").checked;

    let changed=0, skipped=0, empty=0;
    const startRow = hasHeader ? 1 : 0;

    for (let r = startRow; r < aoa.length; r++){
      const row = aoa[r] || (aoa[r] = []);
      const v = row[colIndex];

      const s = normalizeDigits(v);
      if (!s){
        if (skipBlanks) { empty++; continue; }
        row[colIndex] = "00000000"; changed++; continue;
      }

      const res = pad8(s);
      if (!res.ok){ skipped++; continue; }

      // âœ… å†™å›å­—ç¬¦ä¸²ï¼ˆå«å‰å¯¼0ï¼‰
      row[colIndex] = res.value;
      changed++;
    }

    setSheetAOA(sheetName, aoa);

    // âœ… è®°å½•è¯¥åˆ—å·²è¡¥é½ï¼šå¯¼å‡ºæ—¶å¼ºåˆ¶æŒ‰æ–‡æœ¬å†™å…¥
    markPaddedCol(sheetName, colIndex);

    refreshPreview();
    showMsg("ok", `è¡¥é½å®Œæˆï¼šæˆåŠŸ ${changed}ï¼›ç©ºå€¼è·³è¿‡ ${empty}ï¼›è·³è¿‡ï¼ˆéæ•°å­—/è¶…è¿‡8ä½ï¼‰${skipped}\næç¤ºï¼šå¯¼å‡ºæ—¶è¯¥åˆ—ä¼šå¼ºåˆ¶ä¸ºâ€œæ–‡æœ¬æ ¼å¼â€ï¼Œå‰å¯¼0ä¸ä¼šä¸¢ã€‚`);
  });

  $("btnColorize").addEventListener("click", () => {
    if (!wb || colIndex === null) return;
    const aoa = getSheetAOA(sheetName);
    const hasHeader = $("hasHeader").checked;
    const skipBlanks = $("skipBlanks").checked;
    const random = $("randomColor").checked;

    const startRow = hasHeader ? 1 : 0;
    const map = getColorMapFor(sheetName, colIndex);
    map.clear();

    let i = 0;
    for (let r = startRow; r < aoa.length; r++){
      const v = String((aoa[r] && aoa[r][colIndex] !== undefined) ? aoa[r][colIndex] : "").trim();
      if (!v){
        if (skipBlanks) continue;
        if (!map.has("(ç©º)")){
          i++;
          map.set("(ç©º)", random ? randSoft(i) : rgb(softPalette[(i-1)%softPalette.length]));
        }
        continue;
      }
      if (!map.has(v)){
        i++;
        map.set(v, random ? randSoft(i) : rgb(softPalette[(i-1)%softPalette.length]));
      }
    }

    refreshPreview();
    showMsg("ok", `ç€è‰²å®Œæˆï¼šå·²ä¸ºåˆ— ${colLetter(colIndex)} å»ºç«‹é¢œè‰²æ˜ å°„ï¼ˆä¸åŒå†…å®¹ ${map.size} ç§ï¼‰ã€‚åˆ‡æ¢åˆ—ä¸ä¼šä¸¢å¤±ï¼›å¯¼å‡ºä¼šå†™å…¥é¢œè‰²ã€‚`);
  });

  $("btnClearColor").addEventListener("click", () => {
    if (!wb || colIndex === null) return;
    deleteColorMapFor(sheetName, colIndex);
    refreshPreview();
    showMsg("ok", `å·²æ¸…é™¤åˆ— ${colLetter(colIndex)} çš„ç€è‰²æ˜ å°„ã€‚`);
  });

  $("btnCopyCol").addEventListener("click", async () => {
    if (!wb || colIndex === null) return;
    const aoa = getSheetAOA(sheetName);
    const hasHeader = $("hasHeader").checked;
    const startRow = hasHeader ? 1 : 0;

    const lines = [];
    for (let r = startRow; r < aoa.length; r++){
      const v = (aoa[r] && aoa[r][colIndex] !== undefined) ? aoa[r][colIndex] : "";
      lines.push(String(v ?? ""));
    }

    try{
      await navigator.clipboard.writeText(lines.join("\n"));
      showMsg("ok", "å·²å¤åˆ¶è¯¥åˆ—å†…å®¹ï¼ˆå¸¦æ¢è¡Œï¼‰ï¼Œå¯ç›´æ¥ç²˜è´´åˆ° Excel ä¸€åˆ—ã€‚");
    }catch(e){
      showMsg("err", "å¤åˆ¶å¤±è´¥ï¼šæµè§ˆå™¨å¯èƒ½é™åˆ¶å‰ªè´´æ¿æƒé™ã€‚ä½ ä¹Ÿå¯ä»¥ç›´æ¥å¯¼å‡º Excelã€‚");
    }
  });

  $("btnExport").addEventListener("click", () => {
    if (!wb) return;

    try{
      const newWb = XLSX.utils.book_new();

      wb.SheetNames.forEach((name) => {
        const aoa = getSheetAOA(name);
        const ws = XLSX.utils.aoa_to_sheet(aoa);

        const hasHeader = $("hasHeader").checked;
        const skipBlanks = $("skipBlanks").checked;
        const startRow = hasHeader ? 1 : 0;

        // âœ… 1) å¼ºåˆ¶æŠŠâ€œè¡¥é½è¿‡çš„åˆ—â€å†™ä¸ºæ–‡æœ¬æ ¼å¼ï¼ˆä¿ç•™å‰å¯¼0ï¼‰
        const paddedSet = padCols.get(name);
        if (paddedSet && paddedSet.size > 0) {
          paddedSet.forEach((c) => {
            for (let r = startRow; r < aoa.length; r++) {
              const vRaw = (aoa[r] && aoa[r][c] !== undefined) ? aoa[r][c] : "";
              const v = String(vRaw ?? "");

              // å¦‚æœè¦è·³è¿‡ç©ºå€¼ï¼Œåˆ™ç©ºç›´æ¥ç•¥è¿‡ï¼›å¦åˆ™ä¹Ÿå†™æˆæ–‡æœ¬ç©ºå­—ç¬¦ä¸²
              if (skipBlanks && v.trim() === "") continue;

              const addr = XLSX.utils.encode_cell({ r, c });
              ws[addr] = ws[addr] || { v, t: "s" };
              ws[addr].t = "s";
              ws[addr].v = v;
              ws[addr].z = "@"; // æ–‡æœ¬æ ¼å¼

              ws[addr].s = ws[addr].s || {};
              ws[addr].s.numFmt = "@";
            }
          });
        }

        // âœ… 2) æŠŠæœ¬å·¥å…·ç”Ÿæˆçš„é¢œè‰²å†™è¿›å¯¼å‡ºæ–‡ä»¶ï¼ˆæŒ‰sheet/åˆ—æŒä¹…åŒ–ï¼‰
        const sheetMaps = colorMaps.get(name);
        if (sheetMaps && sheetMaps.size > 0){
          sheetMaps.forEach((map, c) => {
            for (let r = startRow; r < aoa.length; r++){
              const vRaw = (aoa[r] && aoa[r][c] !== undefined) ? aoa[r][c] : "";
              const v = String(vRaw ?? "").trim();

              let key = v;
              if (!key){
                if (skipBlanks) continue;
                key = "(ç©º)";
              }

              const color = map.get(key);
              if (!color) continue;

              const addr = XLSX.utils.encode_cell({r, c});
              if (!ws[addr]) ws[addr] = {t:"s", v: String(vRaw ?? "")};

              // å¦‚æœè¯¥å•å…ƒæ ¼è¢«å¼ºåˆ¶æ–‡æœ¬ï¼Œä¿æŒ t/v/zï¼›å¦åˆ™ä¹Ÿä¸ä¼šå½±å“
              if (!ws[addr].t) ws[addr].t = "s";
              if (ws[addr].v === undefined) ws[addr].v = String(vRaw ?? "");

              const hex = toHexFromRgb(color);
              if (!hex) continue;

              ws[addr].s = ws[addr].s || {};
              ws[addr].s.fill = { patternType:"solid", fgColor:{ rgb: hex } };

              // å¦‚æœä½ å¸Œæœ›å­—çœ‹èµ·æ¥æ›´æ¸…æ™°ï¼Œå¯åŠ ä¸ªè¾¹æ¡†ï¼ˆå¯é€‰ï¼‰
              // ws[addr].s.border = { top:{style:"thin",color:{rgb:"DDDDDD"}}, bottom:{style:"thin",color:{rgb:"DDDDDD"}}, left:{style:"thin",color:{rgb:"DDDDDD"}}, right:{style:"thin",color:{rgb:"DDDDDD"}} };
            }
          });
        }

        XLSX.utils.book_append_sheet(newWb, ws, name);
      });

      const base = $("fileInfo").textContent.replace(/\.[^.]+$/, "");
      const outName = `processed_${base}.xlsx`;
      XLSX.writeFile(newWb, outName);
      showMsg("ok", "å·²å¯¼å‡ºæ–° Excelï¼ˆå«é¢œè‰² + æ–‡æœ¬æ ¼å¼ï¼‰ï¼š" + outName);
    }catch(err){
      console.error(err);
      showMsg("err", "å¯¼å‡ºå¤±è´¥ï¼š" + (err?.message || err));
    }
  });

})();
</script>
</body>
</html>
