<!doctype html>
<html lang="zh-CN">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>é¡¾é—®åˆåŒåˆ°æœŸ Â· å€’è®¡æ—¶</title>
  <meta name="color-scheme" content="dark light" />
  <style>
    /* ====== åŸºç¡€ä¸ä¸»é¢˜ ====== */
    :root{
      --bg-1: #0f1020; /* æ·±å¤œè“ */
      --bg-2: #1b0f2a; /* è‘¡è„ç´« */
      --acc-1: #7c4dff; /* éœ“è™¹ç´« */
      --acc-2: #00e5ff; /* éœ“è™¹é’ */
      --acc-3: #ff4081; /* éœ“è™¹ç²‰ */
      --text: #e7f3ff;
      --muted: #9db3c7;
      --glass: rgba(255,255,255,.08);
      --glass-br: rgba(255,255,255,.18);
      --ok: #2dd4bf;
      --warn: #f59e0b;
      --danger: #ef4444;
    }
    *{ box-sizing: border-box; }
    html,body{ height:100%; }
    body{
      margin:0;
      font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, PingFang SC, Hiragino Sans GB, Microsoft YaHei, Noto Sans CJK SC, Helvetica Neue, Arial, "Noto Color Emoji", "Apple Color Emoji", sans-serif;
      color:var(--text);
      /* åŠ¨æ€æ¸å˜èƒŒæ™¯ */
      background:
        radial-gradient(60vmax 60vmax at 10% 15%, #1a1a40 0, transparent 60%),
        radial-gradient(70vmax 70vmax at 90% 10%, #2b0b3a88 0, transparent 60%),
        radial-gradient(80vmax 80vmax at 50% 110%, #00314a88 0, transparent 70%),
        linear-gradient(135deg, var(--bg-1), var(--bg-2));
      overflow-x:hidden;
    }
    .grid-bg{
      position:fixed; inset:0; pointer-events:none; opacity:.18;
      background-image: linear-gradient(transparent 95%, rgba(255,255,255,.12) 95%),
                        linear-gradient(90deg, transparent 95%, rgba(255,255,255,.12) 95%);
      background-size: 32px 32px, 32px 32px;
      mask-image: radial-gradient(70vmax 70vmax at 50% 50%, black 40%, transparent 100%);
    }
    .wrap{min-height:100%; display:flex; align-items:center; justify-content:center; padding:6vmin 4vmin}
    .card{
      width:min(1024px, 96vw);
      backdrop-filter: blur(14px) saturate(120%);
      background: linear-gradient(180deg, var(--glass), transparent);
      border:1px solid var(--glass-br);
      box-shadow: 0 10px 40px rgba(0,0,0,.35), inset 0 0 0 1px rgba(255,255,255,.06);
      border-radius: 24px;
      padding: clamp(16px, 4vmin, 40px);
      position:relative;
    }
    .card::before{
      content:""; position:absolute; inset:-2px; border-radius:24px;
      padding:2px; pointer-events:none;
      background: conic-gradient(from 180deg at 50% 50%, var(--acc-1), var(--acc-2), var(--acc-3), var(--acc-1));
      -webkit-mask: linear-gradient(#000 0 0) content-box, linear-gradient(#000 0 0);
      -webkit-mask-composite: xor; mask-composite: exclude;
      opacity:.35;
      animation: spin 10s linear infinite;
    }
    @keyframes spin{ to{ transform: rotate(360deg); } }

    /* ====== é¡¶éƒ¨ ====== */
    .title{
      display:flex; gap:12px; align-items:center; flex-wrap:wrap;
    }
    .logo{
      width:40px; height:40px; border-radius:12px; display:grid; place-items:center;
      background: radial-gradient(90% 90% at 30% 20%, var(--acc-2), transparent),
                  radial-gradient(120% 120% at 70% 80%, var(--acc-1), transparent),
                  linear-gradient(135deg, #0006, #0000);
      color:#001014; font-weight:900; text-shadow: 0 1px 0 #fff8;
      box-shadow: inset 0 0 12px #fff8;
    }
    h1{ margin:0; font-size: clamp(22px, 4.6vmin, 40px); letter-spacing:.5px; }
    .sub{ color:var(--muted); margin-top:6px; font-size:14px }

    /* ====== æ§ä»¶åŒº ====== */
    .controls{ display:grid; grid-template-columns: 1fr; gap:14px; margin-top:22px }
    @media (min-width:700px){ .controls{ grid-template-columns: 1.2fr .8fr; align-items: end } }

    .field{
      background: rgba(255,255,255,.06);
      border:1px solid rgba(255,255,255,.18);
      border-radius: 16px; padding: 14px; display:grid; gap:8px
    }
    label{ font-size:13px; color:var(--muted) }
    input[type="date"], input[type="text"]{
      width:100%;
      font: inherit; color: var(--text);
      background: #0006; border:1px solid rgba(255,255,255,.15);
      padding: 10px 12px; border-radius: 12px; outline:none;
    }
    .btns{ display:flex; flex-wrap:wrap; gap:10px }
    .btn{
      appearance:none; border:none; cursor:pointer; user-select:none;
      font: inherit; color:white; padding:10px 14px; border-radius:12px;
      background: linear-gradient(135deg, var(--acc-1), var(--acc-2));
      box-shadow: 0 6px 16px rgba(0,0,0,.25), 0 0 0 1px rgba(255,255,255,.1) inset;
      transition: transform .12s ease, filter .12s ease, box-shadow .12s ease;
    }
    .btn:hover{ transform: translateY(-1px); filter:saturate(120%) }
    .btn.secondary{ background: linear-gradient(135deg, #223 0%, #334 100%); color:#cfe7ff }

    /* ====== å€’è®¡æ—¶å±•ç¤º ====== */
    .hero{
      margin-top: 26px;
      border-radius: 20px; padding: clamp(18px, 5vmin, 42px);
      background: radial-gradient(80% 140% at 100% 0%, #ffffff10 0%, #ffffff00 70%),
                  radial-gradient(80% 140% at 0% 100%, #00e5ff15 0%, #ffffff00 70%),
                  linear-gradient(180deg, #ffffff10, #ffffff05);
      border:1px solid rgba(255,255,255,.16);
      position:relative; overflow:hidden;
    }
    .badge{ display:inline-flex; align-items:center; gap:8px; padding:6px 10px; border-radius:999px; font-size:12px; color:#e8f7ff;
      background: linear-gradient(90deg, #ffffff1a, #ffffff08); border:1px solid #ffffff33 }

    .count{
      margin-top: 14px; line-height:1.05;
      font-weight:900; letter-spacing: 1.2px;
      font-size: clamp(28px, 12vmin, 120px);
      text-shadow: 0 0 22px #00e5ff55, 0 0 44px #7c4dff55;
    }
    .count .num{ 
      display:inline-block; padding: 0 .04em; 
      background: linear-gradient(180deg, #fff, #c9ecff);
      -webkit-background-clip:text; background-clip:text; color: transparent;
      filter: drop-shadow(0 6px 24px rgba(0,229,255,.25));
    }
    .subtitle{ margin-top: 10px; color:var(--muted); font-size: clamp(14px, 2.5vmin, 18px) }

    /* ====== è¿›åº¦æ¡ä¸ç»†èŠ‚ ====== */
    .meta{ display:grid; gap:16px; margin-top: 18px }
    @media (min-width:760px){ .meta{ grid-template-columns: 1fr 1fr; gap:18px } }

    .progress{
      position:relative; height: 14px; border-radius:999px; overflow:hidden;
      background:#ffffff14; border:1px solid #ffffff22
    }
    .bar{ position:absolute; inset:0; width:0%; background: linear-gradient(90deg, var(--acc-2), var(--acc-1)); box-shadow: 0 0 24px #00e5ff55 inset }
    .progress .tip{ position:absolute; right:8px; top:50%; transform:translateY(-50%); font-size:12px; color:#e7f3ff; text-shadow:0 1px 0 #000 }

    .grid-2{ display:grid; grid-template-columns: 1fr 1fr; gap:12px }
    .kv{ background:#ffffff0a; border:1px solid #ffffff22; padding:12px 14px; border-radius:14px }
    .kv b{ display:block; font-size:12px; color:#bcd1e5; margin-bottom:6px }
    .kv span{ font-weight:700; }

    /* ====== åº•éƒ¨ ====== */
    .footer{ margin-top: 18px; display:flex; flex-wrap:wrap; gap:10px; align-items:center; justify-content:space-between; color:var(--muted) }
    .links{ display:flex; gap:10px; flex-wrap:wrap }
    .link{ color:#bfe9ff; text-decoration:none; font-size:13px; padding:8px 10px; border-radius:10px; background:#ffffff0a; border:1px solid #ffffff22 }

    /* å°å½©å¸¦ */
    .confetti{ position:absolute; inset:0; pointer-events:none; overflow:hidden }
    .paper{ position:absolute; width:6px; height:14px; border-radius:2px; opacity:0; animation: fall 1.5s ease-out forwards }
    @keyframes fall{ from{ transform: translateY(-40px) rotate(0deg) } to{ transform: translateY(120px) rotate(360deg); opacity:1 } }
  </style>
</head>
<body>
<div class="grid-bg"></div>
<div class="wrap">
  <div class="card" id="app">
    <div class="title">
      <div class="logo">âš¡</div>
      <div>
        <h1>é¡¾é—®åˆåŒåˆ°æœŸ Â· å€’è®¡æ—¶</h1>
        <div class="sub">é€‰æ‹©åˆ°æœŸæ—¥æœŸï¼Œè‡ªåŠ¨ç”Ÿæˆä¸€ä¸ªé†’ç›®çš„å€’è®¡æ—¶ã€‚é»˜è®¤ï¼š2026-05-31ã€‚</div>
      </div>
    </div>

    <div class="controls">
      <div class="field">
        <label for="date">åˆ°æœŸæ—¥æœŸ</label>
        <input id="date" type="date" />
        <div class="btns">
          <button class="btn secondary" data-quick="month-end">æœˆåº•</button>
          <button class="btn secondary" data-quick="year-end">å¹´åº•</button>
          <button class="btn secondary" data-quick="+30">+30å¤©</button>
          <button class="btn secondary" data-quick="+90">+90å¤©</button>
          <button class="btn secondary" data-quick="+180">+180å¤©</button>
          <button class="btn secondary" data-quick="+365">+365å¤©</button>
        </div>
      </div>
      <div class="field" style="align-self:stretch">
        <label>åˆ†äº«/å¯¼å‡º</label>
        <div class="btns">
          <button class="btn" id="copy-link">å¤åˆ¶å¸¦æ—¥æœŸé“¾æ¥</button>
          <button class="btn" id="download-ics">å¯¼å‡º .ics æé†’</button>
        </div>
        <div class="sub" id="share-hint">é“¾æ¥ä¼šæºå¸¦ ?date=YYYY-MM-DDï¼Œå¯æ”¶è—æˆ–åˆ†äº«ã€‚</div>
      </div>
    </div>

    <div class="hero">
      <div class="badge" id="badge">ç›®æ ‡ï¼š<span id="pretty-date">â€”</span> Â· <span id="weekday">â€”</span></div>
      <div class="count" id="count">è·ç¦»è¢«è£è¿˜æœ‰ <span class="num" id="days">â€”</span> å¤©</div>
      <div class="subtitle" id="subtitle">å·²è¿›å…¥å†²åˆºé˜¶æ®µï¼Œç¨³å®šè¾“å‡ºï¼Œç¨³ä½å¿ƒæ€ âœ¨</div>

      <div class="meta">
        <div>
          <div class="progress" aria-label="å‰©ä½™è¿›åº¦">
            <div class="bar" id="bar"></div>
            <div class="tip" id="tip">â€”%</div>
          </div>
          <div class="sub" style="margin-top:8px">ä»ä»Šå¤© <span id="from-date">â€”</span> åˆ°ç›®æ ‡æ—¥å…± <b id="total-days">â€”</b> å¤©ï¼Œå·²å®Œæˆ <b id="done-days">â€”</b> å¤©ã€‚</div>
        </div>

        <div class="grid-2">
          <div class="kv"><b>å½“å‰æ—¶é—´</b><span id="now">â€”</span></div>
          <div class="kv"><b>ç›®æ ‡å‰©ä½™</b><span id="remain">â€”å¤© â€”å°æ—¶ â€”åˆ†</span></div>
        </div>
      </div>
      <div class="confetti" id="confetti"></div>
    </div>

    <div class="footer">
      <div>ğŸ§Š éœ“è™¹ç»ç’ƒé£ Â· æœ¬åœ°è¿è¡Œ Â· æ— éœ€ä¾èµ–</div>
      <div class="links">
        <a class="link" href="#" id="reset">æ¢å¤é»˜è®¤ï¼ˆ2026-05-31ï¼‰</a>
        <a class="link" href="#" id="now-btn">è·³åˆ°ä»Šå¤© 00:00</a>
      </div>
    </div>
  </div>
</div>

<script>
  // ====== å·¥å…·å‡½æ•° ======
  const pad = (n)=> String(n).padStart(2,'0');
  const fmtDate = (d)=> `${d.getFullYear()}-${pad(d.getMonth()+1)}-${pad(d.getDate())}`;
  const zhWeek = ['æ˜ŸæœŸæ—¥','æ˜ŸæœŸä¸€','æ˜ŸæœŸäºŒ','æ˜ŸæœŸä¸‰','æ˜ŸæœŸå››','æ˜ŸæœŸäº”','æ˜ŸæœŸå…­'];

  function endOfDay(d){ const x = new Date(d); x.setHours(23,59,59,999); return x; }
  function startOfDay(d){ const x = new Date(d); x.setHours(0,0,0,0); return x; }

  function monthEnd(base){
    const d = new Date(base);
    return new Date(d.getFullYear(), d.getMonth()+1, 0);
  }
  function yearEnd(base){
    const d = new Date(base);
    return new Date(d.getFullYear(), 11, 31);
  }

  function daysBetween(a, b){
    const ms = endOfDay(b) - startOfDay(a);
    return Math.ceil(ms / 86400000);
  }

  function parseQueryDate(){
    const u = new URL(location.href);
    const q = u.searchParams.get('date');
    if(!q) return null;
    const m = /^\d{4}-\d{2}-\d{2}$/.test(q) ? q : null;
    return m ? new Date(q+'T12:00:00') : null; // ä¸­åˆé¿å…æ—¶åŒºåç§»
  }

  // ====== çŠ¶æ€ ======
  const dateInput = document.querySelector('#date');
  const pretty = document.querySelector('#pretty-date');
  const weekday = document.querySelector('#weekday');
  const daysEl = document.querySelector('#days');
  const countEl = document.querySelector('#count');
  const bar = document.querySelector('#bar');
  const tip = document.querySelector('#tip');
  const fromDateEl = document.querySelector('#from-date');
  const totalDaysEl = document.querySelector('#total-days');
  const doneDaysEl = document.querySelector('#done-days');
  const nowEl = document.querySelector('#now');
  const remainEl = document.querySelector('#remain');
  const badge = document.querySelector('#badge');
  const confetti = document.querySelector('#confetti');

  const DEFAULT = '2026-05-31';

  // åˆå§‹åŒ–æ—¥æœŸï¼šURLä¼˜å…ˆï¼Œå…¶æ¬¡localStorageï¼Œæœ€åé»˜è®¤
  function initDate(){
    const q = parseQueryDate();
    const s = localStorage.getItem('deadline');
    const v = q ? fmtDate(q) : (s || DEFAULT);
    dateInput.value = v;
  }

  // å½©å¸¦åº†ç¥
  function boom(){
    confetti.innerHTML = '';
    const colors = [getComputedStyle(document.documentElement).getPropertyValue('--acc-1').trim(),
                    getComputedStyle(document.documentElement).getPropertyValue('--acc-2').trim(),
                    getComputedStyle(document.documentElement).getPropertyValue('--acc-3').trim(), '#fff'];
    for(let i=0;i<60;i++){
      const p = document.createElement('div');
      p.className = 'paper';
      p.style.left = Math.random()*100+'%';
      p.style.top = Math.random()*10+'%';
      p.style.background = colors[i%colors.length];
      p.style.animationDelay = (Math.random()*0.6)+'s';
      p.style.transform = `translateY(${-(20+Math.random()*40)}px)`;
      confetti.appendChild(p);
    }
    setTimeout(()=> confetti.innerHTML='', 2400);
  }

  // æ›´æ–°é¡µé¢
  function render(){
    const now = new Date();
    const today0 = startOfDay(now);

    // è¯»å–è¾“å…¥å¹¶çº æ­£
    let picked = dateInput.value ? new Date(dateInput.value+'T12:00:00') : new Date(DEFAULT+'T12:00:00');
    const target = endOfDay(picked);

    // æ˜¾ç¤ºå‹å¥½æ—¥æœŸ
    pretty.textContent = `${picked.getFullYear()}å¹´${picked.getMonth()+1}æœˆ${picked.getDate()}æ—¥`;
    weekday.textContent = zhWeek[picked.getDay()];

    // ä¸»æ–‡æ¡ˆ/æ•°å€¼
    const leftDays = daysBetween(today0, picked);
    daysEl.textContent = Math.max(leftDays, 0);

    if(leftDays > 30){
      countEl.style.color = 'white';
      countEl.style.textShadow = '0 0 22px #00e5ff55, 0 0 44px #7c4dff55';
      badge.style.borderColor = '#ffffff33';
    }else if(leftDays > 0){
      countEl.style.color = 'var(--warn)';
      countEl.style.textShadow = '0 0 16px #f59e0b66, 0 0 36px #f59e0b33';
      badge.style.borderColor = '#f59e0b77';
    }else{
      countEl.style.color = 'var(--ok)';
      countEl.style.textShadow = '0 0 18px #2dd4bf77, 0 0 36px #2dd4bf55';
      badge.style.borderColor = '#2dd4bf88';
    }

    // å‰¯æ ‡é¢˜&åº†ç¥
    if(leftDays <= 0){
      countEl.innerHTML = `ğŸ‰ å·²ç»å®‰å…¨åº¦è¿‡ <span class="num">${Math.abs(leftDays)}</span> å¤©`;
      document.title = `å·²è¿‡æœŸ ${Math.abs(leftDays)} å¤© Â· é¡¾é—®åˆåŒå€’è®¡æ—¶`;
      boom();
    }else{
      countEl.innerHTML = `è·ç¦»è¢«è£è¿˜æœ‰ <span class="num" id="days">${leftDays}</span> å¤©`;
      document.title = `è¿˜å‰© ${leftDays} å¤© Â· é¡¾é—®åˆåŒå€’è®¡æ—¶`;
    }

    // è¿›åº¦æ¡ï¼ˆä»ä»Šå¤©åˆ°ç›®æ ‡ï¼‰
    const total = Math.max(daysBetween(today0, picked), 0);
    const done = 0; // ä»¥ä»Šå¤©ä¸ºèµ·ç‚¹ï¼Œå·²å®Œæˆè®° 0
    const pct = total === 0 ? 100 : Math.round((done/Math.max(total,1))*100);
    bar.style.width = (100 - Math.min(total,100)) + '%'; // è§†è§‰ï¼šè¶Šè¿‘è¶Šæ»¡
    tip.textContent = `ç´§è¿«åº¦ ${Math.min(100, Math.round((1/(total+1))*100))}%`;

    fromDateEl.textContent = fmtDate(today0);
    totalDaysEl.textContent = daysBetween(today0, picked);
    doneDaysEl.textContent = done;

    // ç»†èŠ‚å‰©ä½™
    const diffMs = target - now;
    const r = Math.max(diffMs, 0);
    const rh = Math.floor((r % 86400000)/3600000);
    const rm = Math.floor((r % 3600000)/60000);
    remainEl.textContent = `${Math.max(leftDays,0)}å¤© ${pad(rh)}å°æ—¶ ${pad(rm)}åˆ†`;

    nowEl.textContent = `${fmtDate(now)} ${pad(now.getHours())}:${pad(now.getMinutes())}`;

    // å­˜å‚¨ & é“¾æ¥
    const v = fmtDate(picked);
    localStorage.setItem('deadline', v);
    const u = new URL(location.href);
    u.searchParams.set('date', v);
    history.replaceState(null, '', u.toString());
  }

  // ====== äº‹ä»¶ç»‘å®š ======
  document.addEventListener('DOMContentLoaded', ()=>{
    initDate();
    render();

    dateInput.addEventListener('change', render);

    document.querySelectorAll('[data-quick]').forEach(btn=>{
      btn.addEventListener('click', ()=>{
        const kind = btn.getAttribute('data-quick');
        const base = new Date();
        let d = null;
        if(kind === 'month-end') d = monthEnd(base);
        else if(kind === 'year-end') d = yearEnd(base);
        else if(/^\+\d+$/.test(kind)){
          d = new Date(base);
          d.setDate(d.getDate() + Number(kind.slice(1)));
        }
        dateInput.value = fmtDate(d);
        render();
      })
    })

    document.querySelector('#copy-link').addEventListener('click', async ()=>{
      try{
        await navigator.clipboard.writeText(location.href);
        const hint = document.querySelector('#share-hint');
        const txt = hint.textContent;
        hint.textContent = 'âœ… å·²å¤åˆ¶åˆ°å‰ªè´´æ¿ï¼';
        setTimeout(()=> hint.textContent = txt, 1600);
      }catch(e){ alert('å¤åˆ¶å¤±è´¥ï¼Œè¯·æ‰‹åŠ¨å¤åˆ¶åœ°å€æ é“¾æ¥'); }
    });

    document.querySelector('#download-ics').addEventListener('click', ()=>{
      // ç”Ÿæˆä¸€ä¸ªå…¨å¤©äº‹ä»¶çš„ .ics æ–‡ä»¶
      const v = dateInput.value || DEFAULT;
      const dt = v.replaceAll('-', '');
      const ics = `BEGIN:VCALENDAR\nVERSION:2.0\nPRODID:-//Countdown//Advisor Contract//CN\nBEGIN:VEVENT\nUID:${Date.now()}@countdown\nDTSTAMP:${new Date().toISOString().replace(/[-:]/g,'').replace(/\..*/, '')}Z\nDTSTART;VALUE=DATE:${dt}\nSUMMARY:é¡¾é—®åˆåŒåˆ°æœŸæ—¥\nDESCRIPTION:è·ç¦»è¢«è£å€’è®¡æ—¶ï¼ˆç›®æ ‡æ—¥ï¼š${v}ï¼‰\nEND:VEVENT\nEND:VCALENDAR`;
      const blob = new Blob([ics], {type:'text/calendar'});
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url; a.download = `é¡¾é—®åˆåŒåˆ°æœŸ-${v}.ics`;
      document.body.appendChild(a); a.click(); a.remove();
      URL.revokeObjectURL(url);
    });

    document.querySelector('#reset').addEventListener('click', (e)=>{
      e.preventDefault();
      dateInput.value = DEFAULT;
      render();
    });

    document.querySelector('#now-btn').addEventListener('click', (e)=>{
      e.preventDefault();
      // å°†æ—¥æœŸè®¾ä¸ºä»Šå¤©ï¼ˆç”¨äºæ¼”ç¤ºâ€œå·²è¿‡æœŸ/å½“å¤©â€æ ·å¼ï¼‰
      dateInput.value = fmtDate(new Date());
      render();
    });

    // å®æ—¶åˆ·æ–°å‰©ä½™å°æ—¶åˆ†é’Ÿ
    setInterval(render, 30_000); // æ¯30ç§’æ›´æ–°ä¸€æ¬¡ç»†èŠ‚
  });
</script>
</body>
</html>
