<!DOCTYPE html>
<html lang="zh-CN">
<head>
<meta charset="UTF-8">
<title>SCTP ç»¼åˆé“¾è·¯åˆ†æå™¨</title>
<style>
body{font-family:"Segoe UI",Roboto,"Helvetica Neue",Arial,sans-serif;margin:0;padding:20px;background:#f5f7fa;color:#222;position:relative}
h1{margin:0 0 10px;font-size:22px}
textarea{width:100%;height:160px;font-family:monospace;border:1px solid #ccc;border-radius:8px;padding:8px;background:#fff;margin-bottom:8px}
button{background:#2563eb;color:#fff;border:none;border-radius:8px;padding:6px 14px;font-weight:bold;cursor:pointer;margin-top:6px;margin-right:6px}
button:hover{background:#1e4ed8}
table{width:100%;border-collapse:collapse;margin-top:10px;font-size:13px}
th,td{border:1px solid #ddd;padding:6px 8px;text-align:left;vertical-align:top}
th{background:#eef2ff}
tr:nth-child(even){background:#fafbff}
.badge{padding:2px 8px;border-radius:999px;font-weight:bold;font-size:12px}
.badge-ok{background:#dcfce7;color:#166534}
.badge-bad{background:#fee2e2;color:#991b1b}
.badge-part{background:#fef3c7;color:#92400e}
.small{color:#555;font-size:12px;word-break:break-all}
.card{background:#fff;padding:16px;border-radius:10px;box-shadow:0 3px 8px rgba(0,0,0,0.05);margin-bottom:20px}
code{font-family:monospace;background:#f3f4f6;padding:2px 4px;border-radius:4px;font-size:12px;display:block;white-space:pre-wrap}
#langBtn{position:absolute;top:20px;right:20px;background:#6b7280}
#langBtn:hover{background:#4b5563}
.toggle-btn{background:#e5e7eb;color:#111;border:none;border-radius:4px;padding:2px 8px;font-size:12px;cursor:pointer;margin-bottom:4px}
.toggle-btn:hover{background:#d1d5db}
.hidden{display:none;}
.copy-btn{background:#10b981;color:#fff;border:none;border-radius:4px;padding:2px 6px;font-size:11px;margin-left:4px;cursor:pointer}
.copy-btn:hover{background:#059669}
.section-title{font-size:16px;margin:4px 0 8px}
</style>
<!-- Excel å¯¼å‡ºåº“ï¼ˆSheetJSï¼‰ -->
<script src="https://cdn.jsdelivr.net/npm/xlsx@0.18.5/dist/xlsx.full.min.js"></script>
</head>
<body>
<button id="langBtn">ğŸŒ English</button>
<h1 id="mainTitle">SCTP ç»¼åˆé“¾è·¯åˆ†æå™¨</h1>

<div class="card">
  <div style="font-weight:bold;margin-bottom:6px;" id="inputTitle">è¾“å…¥åŒº</div>
  <div>
    <b id="lblSctp">â‘  ç²˜è´´ DBSSCTP è¾“å‡ºï¼š</b>
    <textarea id="txtSctp" placeholder="%%DSP DBSSCTP:;%% è¾“å‡ºï¼ˆå¯é€‰ï¼‰"></textarea>
  </div>
  <div>
    <b id="lblAssoc">â‘¡ ç²˜è´´ DBSSCTPASSOC è¾“å‡ºï¼š</b>
    <textarea id="txtAssoc" placeholder="%%DSP DBSSCTPASSOC:;%% è¾“å‡ºï¼ˆå»ºè®®ç²˜è´´ï¼Œç”¨äºå…¨é‡é…ç½®ï¼‰"></textarea>
  </div>
  <div>
    <b id="lblAlm">â‘¢ ç²˜è´´ DBS SCTP å‘Šè­¦ï¼š</b>
    <textarea id="txtAlm" placeholder="åŒ…å« Module number=ã€Remote DSG number=ã€Local IP/Portã€Peer IP/Port çš„ DBS å‘Šè­¦åˆ—è¡¨ï¼ˆå¯é€‰ï¼‰"></textarea>
  </div>
  <div>
    <button id="btnAnalyze">å¼€å§‹åˆ†æ</button>
    <button id="btnExportHtml" style="background:#059669;">å¯¼å‡ºç»¼åˆè¡¨ HTML</button>
    <button id="btnExportExcel" style="background:#0d9488;">å¯¼å‡ºç»¼åˆè¡¨ Excel</button>
  </div>
</div>

<div id="output"></div>

<script>
// ====== å¤šè¯­è¨€æ–‡æœ¬ ======
let currentLang="zh";
const i18n={
  zh:{
    mainTitle:"SCTP ç»¼åˆé“¾è·¯åˆ†æå™¨",
    inputTitle:"è¾“å…¥åŒº",
    lblSctp:"â‘  ç²˜è´´ DBSSCTP è¾“å‡ºï¼š",
    lblAssoc:"â‘¡ ç²˜è´´ DBSSCTPASSOC è¾“å‡ºï¼š",
    lblAlm:"â‘¢ ç²˜è´´ DBS SCTP å‘Šè­¦ï¼š",
    analyze:"å¼€å§‹åˆ†æ",
    exportHtml:"å¯¼å‡ºç»¼åˆè¡¨ HTML",
    exportExcel:"å¯¼å‡ºç»¼åˆè¡¨ Excel",
    langBtn:"ğŸŒ English",
    noSctp:"ï¼ˆæœªæä¾› DBSSCTP è¾“å‡ºï¼‰",
    noAssoc:"ï¼ˆæœªæä¾› DBSSCTPASSOC è¾“å‡ºï¼‰",
    noAlm:"ï¼ˆæœªæä¾›å‘Šè­¦ï¼Œé»˜è®¤æ‰€æœ‰é“¾è·¯æ­£å¸¸ï¼‰",
    secSctp:"ä¸€ã€DBSSCTP é“¾è·¯å¥åº·ï¼ˆæŒ‰æ¨¡å—/DSGï¼‰",
    secAssoc:"äºŒã€DBSSCTPASSOC å…¨é‡é…ç½®ï¼ˆå«æ­£å¸¸æ–¹å‘è¿‡æ»¤å…¬å¼ï¼‰",
    secMerged:"ä¸‰ã€ç»¼åˆå¯¹ç…§è¡¨ï¼ˆæŒ‰ IP+ç«¯å£åŒ¹é…æ­£å¸¸/å¼‚å¸¸ï¼‰",
    headersSctp:["Service Mod","Remote Loc","Remote DSG","Assoc ID","Link","Health","åŒ¹é…å‘Šè­¦"],
    headersAssoc:["ID","Local IPs","Local Port","Remote IPs","Remote Port","FE ç±»å‹","æ­£å¸¸è¿‡æ»¤å…¬å¼"],
    headersMerged:["ID","Local IPs","Local Port","Remote IPs","Remote Port","çŠ¶æ€","æ­£å¸¸è¿‡æ»¤å…¬å¼","å¼‚å¸¸è¿‡æ»¤å…¬å¼"],
    statusOk:"æ­£å¸¸",
    statusBad:"å¼‚å¸¸",
    statusNoAlm:"æ— å‘Šè­¦",
    statusNoAssoc:"æ— é…ç½®",
    noTable:"â— æœªè§£æåˆ°æœ‰æ•ˆè¡¨æ ¼ï¼Œè¯·æ£€æŸ¥è¾“å…¥æ ¼å¼ã€‚",
    showFormula:"æ˜¾ç¤ºå…¬å¼",
    hideFormula:"éšè—å…¬å¼",
    copyTip:"âœ… å·²å¤åˆ¶åˆ°å‰ªè´´æ¿",
    noMerged:"ï¼ˆç»¼åˆè¡¨éœ€è¦è‡³å°‘æä¾› DBSSCTPASSOCï¼›å¦‚åŒæ—¶æä¾›å‘Šè­¦ï¼Œåˆ™å¯æ ‡è®°å¼‚å¸¸é“¾è·¯ã€‚ï¼‰"
  },
  en:{
    mainTitle:"SCTP Link Full Analyzer",
    inputTitle:"Input Area",
    lblSctp:"â‘  Paste DBSSCTP Output:",
    lblAssoc:"â‘¡ Paste DBSSCTPASSOC Output:",
    lblAlm:"â‘¢ Paste DBS SCTP Alarms:",
    analyze:"Analyze",
    exportHtml:"Export Merged Table HTML",
    exportExcel:"Export Merged Table Excel",
    langBtn:"ğŸŒ ä¸­æ–‡",
    noSctp:"(DBSSCTP output not provided)",
    noAssoc:"(DBSSCTPASSOC output not provided)",
    noAlm:"(Alarms not provided, all links treated as normal)",
    secSctp:"1. DBSSCTP Link Health (by Module / DSG)",
    secAssoc:"2. DBSSCTPASSOC Full Configuration (with normal Wireshark filter)",
    secMerged:"3. Merged View (match normal/abnormal by IP+Port)",
    headersSctp:["Service Mod","Remote Loc","Remote DSG","Assoc ID","Link","Health","Matched Alarms"],
    headersAssoc:["ID","Local IPs","Local Port","Remote IPs","Remote Port","FE Type","Normal Filter"],
    headersMerged:["ID","Local IPs","Local Port","Remote IPs","Remote Port","Status","Normal Filter","Abnormal Filter"],
    statusOk:"OK",
    statusBad:"Abnormal",
    statusNoAlm:"No Alarm",
    statusNoAssoc:"No Config",
    noTable:"â— No valid table parsed, please check the input format.",
    showFormula:"Show Filter",
    hideFormula:"Hide Filter",
    copyTip:"âœ… Copied to clipboard",
    noMerged:"(Merged table requires at least DBSSCTPASSOC; with alarms provided, abnormal links will be marked.)"
  }
};

function applyLang(){
  const L=i18n[currentLang];
  document.title=L.mainTitle;
  document.getElementById("mainTitle").innerText=L.mainTitle;
  document.getElementById("inputTitle").innerText=L.inputTitle;
  document.getElementById("lblSctp").innerText=L.lblSctp;
  document.getElementById("lblAssoc").innerText=L.lblAssoc;
  document.getElementById("lblAlm").innerText=L.lblAlm;
  document.getElementById("btnAnalyze").innerText=L.analyze;
  document.getElementById("btnExportHtml").innerText=L.exportHtml;
  document.getElementById("btnExportExcel").innerText=L.exportExcel;
  document.getElementById("langBtn").innerText=L.langBtn;
  // é‡æ–°æ¸²æŸ“è¾“å‡º
  renderAll();
}

document.getElementById("langBtn").onclick=function(){
  currentLang=currentLang==="zh"?"en":"zh";
  applyLang();
};

// ====== æ•°æ®ç¼“å­˜ï¼Œç”¨äºåˆ‡æ¢è¯­è¨€åé‡æ¸²æŸ“ ======
let lastSctp=[], lastAssoc=[], lastAlm=[], lastMerged=[];

// ====== è§£æå‡½æ•° ======
function parseDBSSCTP(text){
  const lines=text.split(/\r?\n/);
  const arr=[];
  let start=false;
  for(let raw of lines){
    const l=raw.replace(/\u00a0/g,' ').trim();
    if(!l) continue;
    if(!start && /service\s+module\s+number/i.test(l)){start=true;continue;}
    if(!start) continue;
    if(/^---/i.test(l) || /number of results/i.test(l) || /end/i.test(l)) break;
    if(/^-{3,}$/.test(l)) continue;
    const p=l.split(/\s{2,}|\t+/);
    if(p.length>=8){
      arr.push({
        svcMod:p[0],
        remoteLoc:p[1],
        remoteDSG:p[2],
        assoc:p[3],
        link:p[4],
        health:p[6]||"",
        raw:l,
        alarms:[]
      });
    }
  }
  return arr;
}

function parseASSOC(text){
  const lines=text.split(/\r?\n/);
  const arr=[];
  let start=false;
  for(let raw of lines){
    const l=raw.replace(/\u00a0/g,' ').trim();
    if(!l) continue;
    if(!start && /measurement\s+object\s+id/i.test(l)){start=true;continue;}
    if(!start) continue;
    if(/^---/i.test(l) || /number of results/i.test(l) || /end/i.test(l)) break;
    const p=l.split(/\s{2,}|\t+/);
    if(p.length>=8){
      arr.push({
        id:p[0],
        local1:p[1],
        local2:p[2],
        lport:p[3],
        remote1:p[4],
        remote2:p[5],
        rport:p[6],
        fe:p[7]||""
      });
    }
  }
  return arr;
}

function parseAlarms(text){
  const lines=text.split(/\r?\n/);
  const arr=[];
  for(let raw of lines){
    const m=raw.match(/Module number=(\d+).*Remote location number=(\d+).*Remote DSG number=(\d+),Local port=(\d+),Peer port=(\d+),IP type=([^,]+),Local IP=([\d.]+),Peer IP=([\d.]+)/);
    if(m){
      arr.push({
        mod:m[1],
        rloc:m[2],
        dsg:m[3],
        lport:m[4],
        pport:m[5],
        iptype:m[6],
        lip:m[7],
        pip:m[8],
        matched:false,
        raw:raw
      });
    }
  }
  return arr;
}

// DBSSCTP ä¸å‘Šè­¦æŒ‰ module+DSG å…³è”ï¼ˆä»…ç”¨äº DBSSCTP é‚£ä¸ªè¡¨ï¼‰
function matchSctpWithAlarms(sctpRows, alarms){
  for(const s of sctpRows){
    s.alarms=[];
    for(const a of alarms){
      if(a.mod===s.svcMod && a.dsg===s.remoteDSG){
        s.alarms.push(a);
        a.matched=true;
      }
    }
  }
}

// ç»¼åˆè¡¨ï¼šæŒ‰ ASSOC(IP+port) å’Œ å‘Šè­¦(IP+port) åŒ¹é…
function buildMerged(assocRows, alarms){
  const merged=[];
  for(const r of assocRows){
    const normalFilter = makeFilter(r.local1, r.remote1, r.lport, r.rport);
    // æ‰¾å¼‚å¸¸åŒ¹é…ï¼šlocal1/remote1 æˆ– local2/remote2
    const bads = alarms.filter(a =>
      ((a.lip===r.local1 && a.pip===r.remote1) ||
       (a.lip===r.local2 && a.pip===r.remote2) ) &&
      a.lport===r.lport && a.pport===r.rport
    );
    let badFilter="";
    if(bads.length){
      // ç®€å•ï¼šå–ç¬¬ä¸€æ¡
      const a=bads[0];
      badFilter=makeFilter(a.lip,a.pip,a.lport,a.pport);
    }
    merged.push({
      id:r.id,
      local1:r.local1,
      local2:r.local2,
      lport:r.lport,
      remote1:r.remote1,
      remote2:r.remote2,
      rport:r.rport,
      fe:r.fe,
      normalFilter,
      badFilter,
      hasBad: !!badFilter
    });
  }
  return merged;
}

// Wireshark è¿‡æ»¤å…¬å¼ï¼ˆåŒå‘ï¼‰
function makeFilter(lip,pip,lport,pport){
  return `(ip.src == ${lip} && ip.dst == ${pip} && sctp.srcport == ${lport} && sctp.dstport == ${pport})\n`+
         `|| (ip.src == ${pip} && ip.dst == ${lip} && sctp.srcport == ${pport} && sctp.dstport == ${lport})`;
}

// ====== æ¸²æŸ“ ======
function renderAll(){
  const L=i18n[currentLang];
  const out=document.getElementById("output");
  let html="";

  // 1. DBSSCTP
  html+=`<div class="card"><div class="section-title">${L.secSctp}</div>`;
  if(!lastSctp.length){
    html+=`<div class="small">${L.noSctp}</div></div>`;
  }else{
    html+='<table><tr>'+L.headersSctp.map(h=>`<th>${h}</th>`).join('')+'</tr>';
    for(const r of lastSctp){
      let alarmHtml="";
      if(r.alarms && r.alarms.length){
        alarmHtml=r.alarms.map(a=>`<div class="small">${a.lip}:${a.lport} â†’ ${a.pip}:${a.pport}</div>`).join('');
      }else{
        alarmHtml=`<span class="small">${L.statusNoAlm}</span>`;
      }
      html+=`<tr>
        <td>${r.svcMod}</td>
        <td>${r.remoteLoc}</td>
        <td>${r.remoteDSG}</td>
        <td>${r.assoc}</td>
        <td>${r.link}</td>
        <td>${r.health}</td>
        <td>${alarmHtml}</td>
      </tr>`;
    }
    html+='</table></div>';
  }

  // 2. DBSSCTPASSOC
    html+=`<div class="card"><div class="section-title">${L.secAssoc}</div>`;
    if(!lastAssoc.length){
    html+=`<div class="small">${L.noAssoc}</div></div>`;
    }else{
    html+='<table><tr>'+L.headersAssoc.map(h=>`<th>${h}</th>`).join('')+'</tr>';
    for(const r of lastAssoc){
        const fid=`assoc_${r.id}_${r.lport}_${r.rport}`;
        // ç”Ÿæˆå››ç§ç»„åˆçš„è¿‡æ»¤å…¬å¼
        const filters=[
        makeFilter(r.local1,r.remote1,r.lport,r.rport),
        makeFilter(r.local1,r.remote2,r.lport,r.rport),
        makeFilter(r.local2,r.remote1,r.lport,r.rport),
        makeFilter(r.local2,r.remote2,r.lport,r.rport)
        ];
        html+=`<tr>
        <td>${r.id}</td>
        <td>${r.local1}<br>${r.local2}</td>
        <td>${r.lport}</td>
        <td>${r.remote1}<br>${r.remote2}</td>
        <td>${r.rport}</td>
        <td>${r.fe}</td>
        <td>
            <button class="toggle-btn" onclick="toggleFormula('${fid}')">${L.showFormula}</button>
            <div id="${fid}" class="hidden">`;
        filters.forEach((f,i)=>{
        html+=`<div style="margin-bottom:6px;">
            <div class="small">#${i+1}</div>
            <code>${f}</code>
            <button class="copy-btn" onclick="copyText(\`${f}\`)">å¤åˆ¶</button>
        </div>`;
        });
        html+='</div></td></tr>';
    }
    html+='</table></div>';
    }


  // 3. ç»¼åˆè¡¨
    html+=`<div class="card"><div class="section-title">${L.secMerged}</div>`;
    if(!lastAssoc.length){
    html+=`<div class="small">${L.noMerged}</div></div>`;
    }else{
    if(!lastMerged.length){
        html+=`<div class="small">${L.noAlm}</div>`;
    }
    html+='<table id="mergedTable"><tr>'+L.headersMerged.map(h=>`<th>${h}</th>`).join('')+'</tr>';
    for(const r of lastMerged){
        const statusBadge = r.hasBad
        ? `<span class="badge badge-bad">${L.statusBad}</span>`
        : `<span class="badge badge-ok">${L.statusOk}</span>`;

        const nfId=`nf_${r.id}_${r.lport}_${r.rport}`;
        const bfId=`bf_${r.id}_${r.lport}_${r.rport}`;

        // å››ç§æ­£å¸¸è·¯å¾„è¿‡æ»¤å…¬å¼
        const normalFilters=[
        makeFilter(r.local1,r.remote1,r.lport,r.rport),
        makeFilter(r.local1,r.remote2,r.lport,r.rport),
        makeFilter(r.local2,r.remote1,r.lport,r.rport),
        makeFilter(r.local2,r.remote2,r.lport,r.rport)
        ];

        html+=`<tr>
        <td>${r.id}</td>
        <td>${r.local1}<br>${r.local2}</td>
        <td>${r.lport}</td>
        <td>${r.remote1}<br>${r.remote2}</td>
        <td>${r.rport}</td>
        <td>${statusBadge}</td>
        <td>
            <button class="toggle-btn" onclick="toggleFormula('${nfId}')">${L.showFormula}</button>
            <div id="${nfId}" class="hidden">`;
        normalFilters.forEach((f,i)=>{
        html+=`<div style="margin-bottom:6px;">
            <div class="small">#${i+1}</div>
            <code>${f}</code>
            <button class="copy-btn" onclick="copyText(\`${f}\`)">å¤åˆ¶</button>
        </div>`;
        });
        html+='</div></td><td>';

        // å¼‚å¸¸è¿‡æ»¤å…¬å¼ï¼ˆå•æ¡ï¼‰
        if(r.badFilter){
        html+=`<button class="toggle-btn" onclick="toggleFormula('${bfId}')">${L.showFormula}</button>
            <div id="${bfId}" class="hidden">
            <code>${r.badFilter}</code>
            <button class="copy-btn" onclick="copyText(\`${r.badFilter}\`)">å¤åˆ¶</button>
            </div>`;
        }else{
        html+=`<span class="small">${L.statusNoAlm}</span>`;
        }
        html+='</td></tr>';
    }
    html+='</table></div>';
    }


  out.innerHTML=html;
}

// ====== äº‹ä»¶ï¼šåˆ†æ ======
document.getElementById("btnAnalyze").onclick=function(){
  const sctpText=document.getElementById("txtSctp").value;
  const assocText=document.getElementById("txtAssoc").value;
  const almText=document.getElementById("txtAlm").value;

  lastSctp = sctpText.trim()?parseDBSSCTP(sctpText):[];
  lastAssoc = assocText.trim()?parseASSOC(assocText):[];
  lastAlm = almText.trim()?parseAlarms(almText):[];

  // å…ˆç»™ DBSSCTP ç»‘å®šå‘Šè­¦ä¿¡æ¯
  if(lastSctp.length && lastAlm.length){
    matchSctpWithAlarms(lastSctp,lastAlm);
  }

  // æ„å»ºç»¼åˆè¡¨ï¼ˆASSOC + å‘Šè­¦ï¼‰
  if(lastAssoc.length){
    lastMerged = buildMerged(lastAssoc,lastAlm);
  }else{
    lastMerged = [];
  }

  renderAll();
};

// ====== å±•å¼€/æ”¶èµ·å…¬å¼ ======
function toggleFormula(id){
  const div=document.getElementById(id);
  if(!div) return;
  const btn=event.target;
  const L=i18n[currentLang];
  if(div.classList.contains("hidden")){
    div.classList.remove("hidden");
    btn.textContent=L.hideFormula;
  }else{
    div.classList.add("hidden");
    btn.textContent=L.showFormula;
  }
}

// ====== å¤åˆ¶åˆ°å‰ªè´´æ¿ ======
function copyText(text){
  navigator.clipboard.writeText(text).then(()=>{
    alert(i18n[currentLang].copyTip);
  });
}

// ====== å¯¼å‡ºç»¼åˆè¡¨ HTML ======
document.getElementById("btnExportHtml").onclick=function(){
  if(!lastMerged.length){
    alert("æ— ç»¼åˆè¡¨æ•°æ®å¯å¯¼å‡ºï¼Œè¯·å…ˆåˆ†æå¹¶ç¡®ä¿å­˜åœ¨ DBSSCTPASSOC é…ç½®ã€‚");
    return;
  }
  const L=i18n[currentLang];
  const table=document.getElementById("mergedTable");
  if(!table){
    alert("æœªæ‰¾åˆ°ç»¼åˆè¡¨ã€‚");
    return;
  }
  const htmlContent=`<!DOCTYPE html>
<html lang="${currentLang==='zh'?'zh-CN':'en'}">
<head><meta charset="UTF-8">
<title>${L.secMerged}</title>
<style>
body{font-family:"Segoe UI",Arial,sans-serif;background:#f5f7fa;color:#222;padding:20px}
table{width:100%;border-collapse:collapse;font-size:13px;background:#fff}
th,td{border:1px solid #ddd;padding:6px 8px;text-align:left;vertical-align:top}
th{background:#eef2ff}
tr:nth-child(even){background:#fafbff}
.badge{padding:2px 8px;border-radius:999px;font-weight:bold;font-size:12px}
.badge-ok{background:#dcfce7;color:#166534}
.badge-bad{background:#fee2e2;color:#991b1b}
.small{color:#555;font-size:12px;word-break:break-all}
code{font-family:monospace;background:#f3f4f6;padding:2px 4px;border-radius:4px;font-size:12px;display:block;white-space:pre-wrap}
</style>
</head>
<body>
<h2>${L.secMerged}</h2>
${table.outerHTML}
</body></html>`;

  const blob=new Blob([htmlContent],{type:"text/html;charset=utf-8"});
  const url=URL.createObjectURL(blob);
  const a=document.createElement("a");
  a.href=url;
  a.download="SCTP_Merged_Table.html";
  a.click();
  URL.revokeObjectURL(url);
};

// ====== å¯¼å‡ºç»¼åˆè¡¨ Excel ======
document.getElementById("btnExportExcel").onclick=function(){
  if(!lastMerged.length){
    alert("æ— ç»¼åˆè¡¨æ•°æ®å¯å¯¼å‡ºï¼Œè¯·å…ˆåˆ†æå¹¶ç¡®ä¿å­˜åœ¨ DBSSCTPASSOC é…ç½®ã€‚");
    return;
  }
  const L=i18n[currentLang];
  const header=L.headersMerged;
  const data=[header];
  for(const r of lastMerged){
    data.push([
      r.id,
      `${r.local1} / ${r.local2}`,
      r.lport,
      `${r.remote1} / ${r.remote2}`,
      r.rport,
      r.hasBad ? L.statusBad : L.statusOk,
      r.normalFilter,
      r.badFilter || L.statusNoAlm
    ]);
  }
  const ws=XLSX.utils.aoa_to_sheet(data);
  const wb=XLSX.utils.book_new();
  XLSX.utils.book_append_sheet(wb,ws,"Merged");
  XLSX.writeFile(wb,"SCTP_Merged_Table.xlsx");
};

// åˆå§‹æ¸²æŸ“ï¼ˆç©ºï¼‰
renderAll();
applyLang();
</script>
</body>
</html>
