<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å¤–å–å…¨æµç¨‹æ¨¡æ‹Ÿ Demo</title>
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    <style>
        :root {
            --user-color: #e3f2fd;
            --user-btn: #2196f3;
            --merchant-color: #fff3e0;
            --merchant-btn: #ff9800;
            --rider-color: #e8f5e9;
            --rider-btn: #4caf50;
            --text-color: #333;
        }
        body {
            font-family: 'Helvetica Neue', Helvetica, Arial, sans-serif;
            margin: 0;
            padding: 20px;
            background-color: #f0f2f5;
            color: var(--text-color);
        }
        h1 { text-align: center; margin-bottom: 30px; color: #444; }
        
        /* å¸ƒå±€å®¹å™¨ */
        .app-container {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 20px;
            max-width: 1400px;
            margin: 0 auto;
            height: 85vh;
        }

        /* è§’è‰²é¢æ¿é€šç”¨æ ·å¼ */
        .role-panel {
            background: white;
            border-radius: 12px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
            display: flex;
            flex-direction: column;
            overflow: hidden;
            border-top: 6px solid #ccc;
        }

        .panel-header {
            padding: 15px;
            text-align: center;
            font-weight: bold;
            font-size: 1.2em;
            border-bottom: 1px solid #eee;
        }

        .panel-body {
            flex: 1;
            padding: 15px;
            overflow-y: auto;
            background-color: #fafafa;
        }

        /* ç‰¹å®šè§’è‰²é…è‰² */
        .role-user { border-color: var(--user-btn); }
        .role-user .panel-header { background-color: var(--user-color); color: #0d47a1; }
        
        .role-merchant { border-color: var(--merchant-btn); }
        .role-merchant .panel-header { background-color: var(--merchant-color); color: #e65100; }

        .role-rider { border-color: var(--rider-btn); }
        .role-rider .panel-header { background-color: var(--rider-color); color: #1b5e20; }

        /* ç»„ä»¶æ ·å¼ */
        .menu-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 10px;
            margin-bottom: 20px;
        }
        
        .menu-item {
            background: white;
            border: 1px solid #ddd;
            padding: 10px;
            border-radius: 8px;
            cursor: pointer;
            text-align: center;
            transition: all 0.2s;
        }
        .menu-item:hover { border-color: var(--user-btn); background-color: #f5faff; }
        .menu-item.active { background-color: var(--user-btn); color: white; border-color: var(--user-btn); }

        .order-card {
            background: white;
            border-radius: 8px;
            padding: 12px;
            margin-bottom: 12px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.05);
            border-left: 4px solid #ccc;
            font-size: 0.9em;
            position: relative;
            transition: all 0.3s ease;
        }
        
        /* è®¢å•çŠ¶æ€é¢œè‰²æ¡ */
        .status-wait_pay { border-left-color: #999; }
        .status-pending { border-left-color: #ff9800; } /* å¾…æ¥å• */
        .status-cooking { border-left-color: #9c27b0; } /* åˆ¶ä½œä¸­ */
        .status-wait_rider { border-left-color: #2196f3; } /* å¾…æŠ¢å• */
        .status-delivering { border-left-color: #4caf50; } /* é…é€ä¸­ */
        .status-completed { border-left-color: #607d8b; opacity: 0.8; } /* å®Œæˆ */

        .order-header { display: flex; justify-content: space-between; margin-bottom: 6px; font-weight: bold; color: #555; }
        .order-info { margin-bottom: 8px; color: #666; }
        .order-tags span { 
            background: #eee; padding: 2px 6px; border-radius: 4px; font-size: 0.8em; margin-right: 5px; 
        }
        .tag-delivery { background: #e3f2fd; color: #1565c0; }
        .tag-pickup { background: #fff3e0; color: #ef6c00; }

        /* æŒ‰é’® */
        .btn {
            border: none;
            padding: 6px 12px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 0.85em;
            transition: opacity 0.2s;
        }
        .btn:hover { opacity: 0.8; }
        .btn-block { width: 100%; padding: 10px; font-size: 1em; margin-top: 10px;}
        
        .btn-primary { background: var(--user-btn); color: white; }
        .btn-merchant { background: var(--merchant-btn); color: white; }
        .btn-rider { background: var(--rider-btn); color: white; }
        .btn-disabled { background: #ccc; cursor: not-allowed; }

        .section-title {
            font-size: 0.9em;
            color: #888;
            margin: 15px 0 8px 0;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        /* Tab åˆ‡æ¢ */
        .tabs { display: flex; margin-bottom: 10px; border-bottom: 1px solid #eee; }
        .tab { padding: 8px 15px; cursor: pointer; font-size: 0.9em; color: #666; }
        .tab.active { color: #333; font-weight: bold; border-bottom: 2px solid #333; }

        .empty-tip { text-align: center; color: #aaa; padding: 20px; font-size: 0.9em; }

        /* åŠ¨ç”» */
        .list-enter-active, .list-leave-active { transition: all 0.4s ease; }
        .list-enter-from, .list-leave-to { opacity: 0; transform: translateX(-20px); }
    </style>
</head>
<body>

<div id="app">
    <h1>ğŸ“¦ å¤–å–ä¸šåŠ¡å…¨æµç¨‹ä»¿çœŸ Demo</h1>

    <div class="app-container">
        
        <!-- ================= ç”¨æˆ·ç«¯ ================= -->
        <div class="role-panel role-user">
            <div class="panel-header">
                <span>ğŸ“± ç”¨æˆ·ç«¯ (User)</span>
            </div>
            <div class="panel-body">
                <!-- é…é€æ–¹å¼é€‰æ‹© -->
                <div style="display: flex; background: #eee; border-radius: 8px; padding: 4px; margin-bottom: 15px;">
                    <div style="flex:1; text-align: center; padding: 6px; border-radius: 6px; cursor: pointer;"
                         :style="orderForm.type === 'delivery' ? 'background:white; font-weight:bold; shadow:0 2px 4px rgba(0,0,0,0.1)' : ''"
                         @click="orderForm.type = 'delivery'">
                         ğŸ›µ å¤–å–é…é€
                    </div>
                    <div style="flex:1; text-align: center; padding: 6px; border-radius: 6px; cursor: pointer;"
                         :style="orderForm.type === 'pickup' ? 'background:white; font-weight:bold; shadow:0 2px 4px rgba(0,0,0,0.1)' : ''"
                         @click="orderForm.type = 'pickup'">
                         ğŸª åˆ°åº—è‡ªå–
                    </div>
                </div>

                <!-- èœå• -->
                <div class="menu-grid">
                    <div class="menu-item" 
                         v-for="food in menu" 
                         :key="food.id"
                         :class="{active: orderForm.items.includes(food.name)}"
                         @click="toggleFood(food.name)">
                        {{ food.icon }} {{ food.name }}<br>
                        <small>Â¥{{ food.price }}</small>
                    </div>
                </div>

                <div style="border-top: 1px solid #eee; padding-top: 10px;">
                    <div style="display:flex; justify-content: space-between; align-items: center;">
                        <span>åˆè®¡: <strong style="font-size: 1.2em;">Â¥{{ currentTotal }}</strong></span>
                        <small style="color:#888">{{ orderForm.items.length }} ä»¶å•†å“</small>
                    </div>
                    <button class="btn btn-primary btn-block" 
                            :class="{'btn-disabled': orderForm.items.length === 0}"
                            @click="submitOrder">
                        æäº¤å¹¶æ”¯ä»˜
                    </button>
                </div>

                <!-- ç”¨æˆ·è®¢å•åˆ—è¡¨ -->
                <div class="section-title">æˆ‘çš„è®¢å•</div>
                <transition-group name="list" tag="div">
                    <div v-for="order in userOrders" :key="order.id" class="order-card" :class="'status-' + order.statusCode">
                        <div class="order-header">
                            <span>#{{ order.id }} {{ order.shopName }}</span>
                            <span :style="{color: getStatusColor(order.statusCode)}">{{ order.statusText }}</span>
                        </div>
                        <div class="order-tags">
                            <span :class="order.type === 'delivery' ? 'tag-delivery' : 'tag-pickup'">
                                {{ order.type === 'delivery' ? 'å¤–å–' : 'è‡ªå–' }}
                            </span>
                            <span>{{ order.createTime }}</span>
                        </div>
                        <div class="order-info" style="margin-top: 8px;">
                            {{ order.items.join(', ') }}
                        </div>
                        <!-- ç”¨æˆ·æ“ä½œï¼šç¡®è®¤æ”¶è´§ -->
                        <div v-if="order.statusCode === 'delivering' || (order.type==='pickup' && order.statusCode==='wait_rider')" style="text-align: right;">
                             <button class="btn btn-primary" @click="confirmReceipt(order)">
                                {{ order.type==='delivery' ? 'ç¡®è®¤æ”¶è´§' : 'å·²è‡ªæ' }}
                             </button>
                        </div>
                    </div>
                </transition-group>
                <div v-if="userOrders.length === 0" class="empty-tip">æš‚æ— å†å²è®¢å•</div>
            </div>
        </div>

        <!-- ================= å•†å®¶ç«¯ ================= -->
        <div class="role-panel role-merchant">
            <div class="panel-header">
                <span>ğŸ§‘â€ğŸ³ å•†å®¶ç«¯ (Merchant)</span>
            </div>
            <div class="panel-body">
                <div class="tabs">
                    <div class="tab" :class="{active: merchantTab==='new'}" @click="merchantTab='new'">æ–°è®¢å• ({{ merchantNewOrders.length }})</div>
                    <div class="tab" :class="{active: merchantTab==='cooking'}" @click="merchantTab='cooking'">åˆ¶ä½œä¸­ ({{ merchantCookingOrders.length }})</div>
                </div>

                <transition-group name="list" tag="div">
                    <div v-for="order in merchantCurrentList" :key="order.id" class="order-card" :class="'status-' + order.statusCode">
                        <div class="order-header">
                            <span>#{{ order.id }} {{ order.type === 'delivery' ? '(éœ€é…é€)' : '(è‡ªå–)' }}</span>
                            <span style="font-size: 0.8em; color: #666">{{ order.totalPrice }}å…ƒ</span>
                        </div>
                        <div class="order-info">{{ order.items.join(' + ') }}</div>
                        
                        <!-- å•†å®¶æ“ä½œåŒº -->
                        <div style="display: flex; gap: 10px; margin-top: 8px;">
                            <!-- å¾…æ¥å•çŠ¶æ€ -->
                            <template v-if="order.statusCode === 'pending'">
                                <button class="btn btn-merchant" style="flex:1" @click="merchantAccept(order)">æ¥å•</button>
                                <button class="btn" style="flex:1; background:#eee" @click="cancelOrder(order)">æ‹’ç»</button>
                            </template>
                            
                            <!-- åˆ¶ä½œä¸­çŠ¶æ€ -->
                            <template v-if="order.statusCode === 'cooking'">
                                <button class="btn btn-merchant" style="flex:1" @click="merchantFinishCook(order)">
                                    {{ order.type === 'delivery' ? 'å‡ºé¤ (å‘¼å«éª‘æ‰‹)' : 'å‡ºé¤ (é€šçŸ¥å–é¤)' }}
                                </button>
                            </template>
                        </div>
                    </div>
                </transition-group>

                <div v-if="merchantCurrentList.length === 0" class="empty-tip">
                    {{ merchantTab==='new' ? 'æš‚æ— æ–°è®¢å•' : 'åå¨ç©ºé—²ä¸­' }}
                </div>
            </div>
        </div>

        <!-- ================= éª‘æ‰‹ç«¯ ================= -->
        <div class="role-panel role-rider">
            <div class="panel-header">
                <span>ğŸ›µ éª‘æ‰‹ç«¯ (Rider)</span>
            </div>
            <div class="panel-body">
                <!-- éª‘æ‰‹åªå…³å¿ƒé…é€å•ï¼Œè‡ªå–å•ä¸æ˜¾ç¤º -->
                <div class="tabs">
                    <div class="tab" :class="{active: riderTab==='pool'}" @click="riderTab='pool'">æŠ¢å•æ±  ({{ riderPool.length }})</div>
                    <div class="tab" :class="{active: riderTab==='mine'}" @click="riderTab='mine'">é…é€ä¸­ ({{ riderMine.length }})</div>
                </div>

                <transition-group name="list" tag="div">
                    <div v-for="order in riderCurrentList" :key="order.id" class="order-card" :class="'status-' + order.statusCode">
                        <div class="order-header">
                            <span>#{{ order.id }} {{ order.shopName }}</span>
                            <span style="color: var(--rider-btn)">
                                {{ order.statusCode === 'wait_rider' ? 'å¾…æŠ¢å•' : 'é…é€ä¸­' }}
                            </span>
                        </div>
                        <div class="order-info">
                            <div>ğŸ“ å•†å®¶ï¼šç¾å‘³å¤§é¥­åº—</div>
                            <div>ğŸ  é¡¾å®¢ï¼šæ¨¡æ‹Ÿåœ°å€Aåº§808</div>
                        </div>
                        <div class="order-info">ğŸ“¦ {{ order.items.join(', ') }}</div>

                        <!-- éª‘æ‰‹æ“ä½œåŒº -->
                        <div style="margin-top: 8px;">
                            <button v-if="order.statusCode === 'wait_rider'" 
                                    class="btn btn-rider btn-block" 
                                    @click="riderGrab(order)">
                                âš¡ ç«‹å³æŠ¢å•
                            </button>
                            
                            <div v-if="order.statusCode === 'delivering'" style="display:flex; gap:10px;">
                                <button class="btn btn-rider btn-block" @click="riderArrive(order)">
                                    ç¡®è®¤é€è¾¾
                                </button>
                            </div>
                        </div>
                    </div>
                </transition-group>

                <div v-if="riderCurrentList.length === 0" class="empty-tip">
                    {{ riderTab==='pool' ? 'æš‚æ— å¾…æŠ¢è®¢å•' : 'æš‚æ— è¿›è¡Œä¸­ä»»åŠ¡' }}
                </div>

                <!-- ç®€å•çš„ç»Ÿè®¡ -->
                <div style="margin-top: auto; border-top: 1px solid #eee; padding-top: 10px; font-size: 0.8em; color: #888;">
                    ä»Šæ—¥å·²é€è¾¾: {{ completedOrders.filter(o => o.type === 'delivery').length }} å•
                </div>
            </div>
        </div>

    </div>
</div>

<script>
    const { createApp, reactive, computed, ref } = Vue;

    createApp({
        setup() {
            // ================== æ•°æ®çŠ¶æ€ ==================
            
            // æ¨¡æ‹Ÿæ•°æ®åº“ä¸­çš„æ‰€æœ‰è®¢å•
            const allOrders = reactive([]);
            
            // èœå•é…ç½®
            const menu = [
                { id: 1, name: 'é¦™è¾£é¸¡è…¿å ¡', price: 20, icon: 'ğŸ”' },
                { id: 2, name: 'è¶…çº§è‡³å°ŠæŠ«è¨', price: 55, icon: 'ğŸ•' },
                { id: 3, name: 'å†°é•‡å¯ä¹', price: 5, icon: 'ğŸ¥¤' },
                { id: 4, name: 'ç‚¸è–¯æ¡', price: 12, icon: 'ğŸŸ' }
            ];

            // ç”¨æˆ·ä¸‹å•è¡¨å•
            const orderForm = reactive({
                type: 'delivery', // delivery or pickup
                items: []
            });

            // ç•Œé¢TabçŠ¶æ€
            const merchantTab = ref('new');
            const riderTab = ref('pool');

            // ================== è®¡ç®—å±æ€§ (ä¸šåŠ¡è§†å›¾) ==================

            const currentTotal = computed(() => {
                return orderForm.items.reduce((sum, itemName) => {
                    const item = menu.find(f => f.name === itemName);
                    return sum + (item ? item.price : 0);
                }, 0);
            });

            // ç”¨æˆ·çœ‹åˆ°çš„è®¢å•ï¼ˆå€’åºï¼‰
            const userOrders = computed(() => {
                return [...allOrders].sort((a,b) => b.id - a.id);
            });

            // å•†å®¶çœ‹åˆ°çš„åˆ—è¡¨
            const merchantNewOrders = computed(() => allOrders.filter(o => o.statusCode === 'pending'));
            const merchantCookingOrders = computed(() => allOrders.filter(o => o.statusCode === 'cooking'));
            const merchantCurrentList = computed(() => {
                return merchantTab.value === 'new' ? merchantNewOrders.value : merchantCookingOrders.value;
            });

            // éª‘æ‰‹çœ‹åˆ°çš„åˆ—è¡¨ (åªçœ‹ Delivery ç±»å‹çš„å•å­)
            const riderPool = computed(() => allOrders.filter(o => o.type === 'delivery' && o.statusCode === 'wait_rider'));
            const riderMine = computed(() => allOrders.filter(o => o.type === 'delivery' && o.statusCode === 'delivering'));
            const riderCurrentList = computed(() => {
                return riderTab.value === 'pool' ? riderPool.value : riderMine.value;
            });

            const completedOrders = computed(() => allOrders.filter(o => o.statusCode === 'completed'));

            // ================== åŠ¨ä½œæ–¹æ³• (ä¸šåŠ¡é€»è¾‘) ==================

            // 1. ç”¨æˆ·ä¸‹å•
            const toggleFood = (name) => {
                const idx = orderForm.items.indexOf(name);
                if(idx > -1) orderForm.items.splice(idx, 1);
                else orderForm.items.push(name);
            };

            const submitOrder = () => {
                if(orderForm.items.length === 0) return;

                const newOrder = {
                    id: Date.now().toString().slice(-4), // ç®€æ˜“ID
                    createTime: new Date().toLocaleTimeString(),
                    type: orderForm.type,
                    items: [...orderForm.items],
                    totalPrice: currentTotal.value,
                    shopName: 'ç¾å‘³å¤§é¥­åº—',
                    // çŠ¶æ€æœºæ ¸å¿ƒï¼š initial state
                    statusCode: 'pending', 
                    statusText: 'å·²æ”¯ä»˜ï¼Œç­‰å¾…å•†å®¶æ¥å•',
                    riderId: null
                };

                allOrders.push(newOrder);
                
                // é‡ç½®è¡¨å•
                orderForm.items = [];
                
                // æ¨¡æ‹Ÿæ”¯ä»˜ç¨å¾®å»¶è¿Ÿä¸€ç‚¹ç‚¹çš„æ„Ÿè§‰ï¼ˆå…¶å®æ˜¯åŒæ­¥çš„ï¼Œä½†ä¸ºäº†UXï¼‰
                alert(`æ”¯ä»˜æˆåŠŸ Â¥${newOrder.totalPrice}ï¼è®¢å•å·²å‘é€ç»™å•†å®¶ã€‚`);
            };

            // ç”¨æˆ·ç¡®è®¤æ”¶è´§
            const confirmReceipt = (order) => {
                order.statusCode = 'completed';
                order.statusText = 'å·²å®Œæˆ';
            };

            // 2. å•†å®¶é€»è¾‘
            const merchantAccept = (order) => {
                order.statusCode = 'cooking';
                order.statusText = 'å•†å®¶å·²æ¥å•ï¼Œåˆ¶ä½œä¸­...';
                // è‡ªåŠ¨åˆ‡æ¢åˆ°åˆ¶ä½œä¸­Tabæ–¹ä¾¿æ¼”ç¤º
                merchantTab.value = 'cooking'; 
            };

            const cancelOrder = (order) => {
                const idx = allOrders.indexOf(order);
                allOrders.splice(idx, 1);
                alert('è®¢å•å·²æ‹’ç»/å–æ¶ˆ');
            };

            const merchantFinishCook = (order) => {
                // åˆ†æµé€»è¾‘
                if (order.type === 'delivery') {
                    // å¤–å– -> è¿›å…¥éª‘æ‰‹æ± 
                    order.statusCode = 'wait_rider';
                    order.statusText = 'å¾…éª‘æ‰‹æ¥å•';
                } else {
                    // è‡ªå– -> é€šçŸ¥ç”¨æˆ·æ¥æ‹¿
                    order.statusCode = 'wait_rider'; // å¤ç”¨çŠ¶æ€ç ï¼Œä½†åœ¨å‰ç«¯æ–‡æ¡ˆä¸ŠåŒºåˆ†
                    order.statusText = 'å¾…å–é¤ (è¯·å‡­å·å–é¤)';
                }
            };

            // 3. éª‘æ‰‹é€»è¾‘
            const riderGrab = (order) => {
                order.statusCode = 'delivering';
                order.statusText = 'éª‘æ‰‹å·²æ¥å•ï¼Œé…é€ä¸­';
                order.riderId = 'Rider_001';
                // è‡ªåŠ¨åˆ‡Tab
                riderTab.value = 'mine';
            };

            const riderArrive = (order) => {
                // éª‘æ‰‹ç‚¹å‡»é€è¾¾ï¼Œé€šå¸¸çŠ¶æ€å˜ä¸ºâ€œç”¨æˆ·å¾…ç¡®è®¤â€æˆ–ç›´æ¥â€œå®Œæˆâ€
                // è¿™é‡Œä¸ºäº†Demoç®€åŒ–ï¼Œè®¾ä¸ºå®Œæˆ
                order.statusCode = 'completed';
                order.statusText = 'å·²é€è¾¾';
            };

            // å·¥å…·ï¼šçŠ¶æ€é¢œè‰²è¾…åŠ©
            const getStatusColor = (code) => {
                const map = {
                    'pending': '#ff9800',
                    'cooking': '#9c27b0',
                    'wait_rider': '#2196f3',
                    'delivering': '#4caf50',
                    'completed': '#888'
                };
                return map[code] || '#000';
            };

            return {
                menu,
                orderForm,
                currentTotal,
                userOrders,
                merchantTab,
                merchantCurrentList,
                merchantNewOrders,
                merchantCookingOrders,
                riderTab,
                riderCurrentList,
                riderPool,
                riderMine,
                completedOrders,
                
                toggleFood,
                submitOrder,
                confirmReceipt,
                merchantAccept,
                cancelOrder,
                merchantFinishCook,
                riderGrab,
                riderArrive,
                getStatusColor
            };
        }
    }).mount('#app');
</script>

</body>
</html>
